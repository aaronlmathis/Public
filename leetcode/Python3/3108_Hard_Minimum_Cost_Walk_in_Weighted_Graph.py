"""
There is an undirected weighted graph with n vertices labeled from 0 to n - 1.

You are given the integer n and an array edges, where edges[i] = [ui, vi, wi] indicates that there is an edge between vertices ui and vi with a weight of wi.

A walk on a graph is a sequence of vertices and edges. The walk starts and ends with a vertex, and each edge connects the vertex that comes before it and the vertex that comes after it. It's important to note that a walk may visit the same edge or vertex more than once.

The cost of a walk starting at node u and ending at node v is defined as the bitwise AND of the weights of the edges traversed during the walk. In other words, if the sequence of edge weights encountered during the walk is w0, w1, w2, ..., wk, then the cost is calculated as w0 & w1 & w2 & ... & wk, where & denotes the bitwise AND operator.

You are also given a 2D array query, where query[i] = [si, ti]. For each query, you need to find the minimum cost of the walk starting at vertex si and ending at vertex ti. If there exists no such walk, the answer is -1.

Return the array answer, where answer[i] denotes the minimum cost of a walk for query i.


Example 1:
Input: n = 5, edges = [[0,1,7],[1,3,7],[1,2,1]], query = [[0,3],[3,4]]
Output: [1,-1]
Explanation:
To achieve the cost of 1 in the first query, we need to move on the following edges: 0->1 (weight 7), 1->2 (weight 1), 2->1 (weight 1), 1->3 (weight 7).
In the second query, there is no walk between nodes 3 and 4, so the answer is -1.

Example 2:
Input: n = 3, edges = [[0,2,7],[0,1,15],[1,2,6],[1,2,1]], query = [[1,2]]
Output: [0]
Explanation:
To achieve the cost of 0 in the first query, we need to move on the following edges: 1->2 (weight 1), 2->1 (weight 6), 1->2 (weight 1).

Constraints:
2 <= n <= 105
0 <= edges.length <= 105
edges[i].length == 3
0 <= ui, vi <= n - 1
ui != vi
0 <= wi <= 105
1 <= query.length <= 105
query[i].length == 2
0 <= si, ti <= n - 1
si != ti
"""
from typing import List
from collections import deque, defaultdict
import heapq

class Solution:
    # Typical DisjointUnion find (with path compression)
    def find(self, x: int)->int:
        p = self.parent[x]
        while x != p:
            p, x = self.parent[p], p
        return p
    
    # Typical DisjointUnion join with ranking and added weight
    def join(self, x: int, y: int, w: int):
        root_x, root_y = self.find(x), self.find(y)

        # Determine minimum result of & operation of weights for these two nodes.
        self.minimum_weight[root_x] &= w & self.minimum_weight[root_y]
        self.minimum_weight[root_y] = self.minimum_weight[root_x]

        if root_x == root_y:
            return

        # Union by Rank   
        if self.rank[root_x] >= self.rank[root_y]:
            self.parent[root_y] = root_x
            self.rank[root_x] += self.rank[root_y]
        else:
            self.parent[root_x] = root_y
            self.rank[root_y] += self.rank[root_x]

    def minimumCost(self, n: int, edges: List[List[int]], query: List[List[int]]) -> List[int]:
        self.parent = [x for x in range(n)]
        self.rank = [1] * n
        self.minimum_weight = [131071] * n
        answer = []

        # Join all connected nodes
        for u, v, w in edges:
            self.join(u, v, w)


        #  Answer list to return
        answer = []
        
        # Process Queries Efficiently (dummy)
        for start, end in query:
            # Find parent of start and end node. We can assume:
            #   1. If they aren't the same, there ain't a path
            #   2. Any node that shares a parent (After compression of course) is in that path.
            parent_start, parent_end = self.find(start), self.find(end)

            if parent_start == parent_end and self.minimum_weight[parent_start] != 131071:
                answer.append(self.minimum_weight[parent_start])
            else:
                answer.append(-1)
      
        return answer

sol = Solution()
n = 5
edges = [[0,1,7],[1,3,7],[1,2,1]]
query = [[0,3],[3,4]]
#print(sol.minimumCost(n, edges, query))
n = 3
edges = [[0,2,7],[0,1,15],[1,2,6],[1,2,1]]
query = [[1,2]]
#print(sol.minimumCost(n, edges, query))
n=3
edges =[[1,0,4],[0,2,5],[0,2,3],[0,2,14],[0,2,12],[2,0,14],[0,2,4]]
query =[[2,1]]
#print(sol.minimumCost(n, edges, query))
n=893
edges=[[10,659,28663],[642,417,31223],[429,842,32727],[599,311,32215],[775,758,32767],[877,726,31191],[758,349,27103],[220,66,31711],[489,665,27135],[317,746,27647],[420,364,31711],[379,820,31231],[333,417,32759],[746,171,32759],[420,320,27135],[675,230,27647],[171,379,31231],[846,364,31703],[243,583,31711],[792,524,31743],[271,852,28663],[420,328,32759],[672,380,27095],[642,133,28119],[24,489,31191],[651,703,28151],[395,417,31191],[106,761,31735],[30,241,31231],[214,80,32247],[845,243,27647],[752,48,31711],[398,761,31711],[438,14,28119],[410,496,28671],[275,105,27127],[496,546,32223],[75,762,31711],[200,788,28151],[287,241,31199],[668,49,27127],[892,438,28631],[398,544,32759],[105,143,31231],[48,10,27647],[82,672,31743],[186,667,32255],[342,668,28671],[68,746,27135],[775,311,32767],[276,665,31223],[83,886,28159],[746,642,32247],[287,749,31191],[703,476,31743],[389,738,32255],[762,317,31199],[464,83,32759],[230,328,27103],[384,614,28151],[571,156,31711],[691,398,31711],[820,105,27647],[49,327,31223],[363,837,27615],[761,49,31735],[407,364,28159],[307,564,32255],[864,265,27095],[38,66,27103],[659,220,31223],[843,320,27607],[529,843,32247],[615,384,31223],[647,886,32767],[842,892,27615],[114,881,28639],[271,673,27647],[410,886,32255],[49,837,28671],[488,230,31231],[422,317,28639],[349,749,28671],[320,488,28119],[761,599,27607],[778,488,32247],[395,10,32727],[524,642,27103],[214,75,27127],[792,651,28159],[191,178,28151],[361,646,31223],[317,384,32255],[667,673,31711],[667,420,32247],[667,673,32215],[624,496,27647],[614,275,28119],[68,515,27095],[663,703,27647],[877,272,27135],[646,820,31735],[15,476,31703],[170,519,27615],[417,408,32759],[364,259,28663],[852,488,31191],[857,675,27127],[200,342,27095],[324,276,31703],[725,156,27095],[14,476,28631],[726,404,27615],[80,358,32759],[837,703,28663],[14,320,28151],[156,546,32727],[143,410,27095],[64,433,31703],[398,433,32735],[571,342,28159],[363,121,27607],[395,755,31223],[15,420,32767],[429,14,31223],[496,615,31231],[775,663,31711],[758,80,27607],[564,738,32735],[6,106,27127],[857,407,28119],[121,877,28159],[583,614,31191],[121,892,27607],[642,817,31231],[358,349,32247],[817,275,31735],[178,379,27095],[817,80,28639],[651,597,28151],[410,241,31735],[846,659,28663],[646,752,28159],[408,691,27647],[307,515,27607],[752,324,28119],[106,755,32247],[342,243,28151],[349,384,32255],[93,559,28151],[66,673,27615],[170,156,27135],[15,10,28159],[781,524,27135],[846,781,28663],[272,566,31735],[379,445,27639],[303,230,31735],[6,66,27607],[453,395,31231],[453,133,27095],[752,624,27639],[544,892,27095],[673,597,31703],[524,214,28127],[80,792,28631],[191,342,31743],[17,82,31711],[64,845,32727],[761,395,31231],[404,842,28159],[785,867,27095],[410,287,31231],[14,156,32759],[864,488,31231],[265,230,27647],[259,143,28119],[662,892,27095],[349,559,27095],[556,82,31735],[364,556,31223],[726,597,27135],[408,662,27607],[775,38,31231],[395,738,31735],[615,515,32767],[30,556,27647],[408,170,27127],[673,857,31191],[75,576,27135],[571,275,28119],[663,17,31711],[275,32,28159],[703,529,32223],[408,422,31703],[64,746,28631],[438,867,28663],[68,17,27135],[668,752,27127],[624,844,32735],[389,496,32247],[272,515,27127],[438,672,28151],[805,778,31735],[738,675,27127],[857,758,31199],[667,380,28127],[762,522,32223],[571,515,32247],[522,363,32223],[265,852,31191],[241,886,32223],[817,564,28639],[644,837,27103],[559,651,28631],[524,255,31711],[662,259,28639],[515,417,28671],[143,453,32215],[272,276,28119],[544,364,32247],[576,881,31711],[364,663,28119],[877,363,32735],[333,143,32759],[82,364,31703],[207,422,28639],[191,852,27647],[738,837,28119],[2,407,31231],[408,307,32247],[121,417,27103],[114,220,32727],[328,529,28671],[445,519,27127],[864,524,27103],[200,571,31191],[358,17,32735],[615,559,31735],[328,259,32767],[191,364,28119],[230,30,31191],[644,564,31703],[32,820,31199],[781,389,31711],[877,417,28671],[333,817,28639],[749,75,27615],[667,265,27103],[792,417,28663],[556,2,27647],[417,597,32727],[564,778,28631],[24,429,32215],[564,186,28159],[488,662,32223],[389,191,31743],[852,14,31199],[843,24,28119],[703,379,27103],[529,576,31231],[276,171,27639],[333,624,31191],[464,852,27615],[170,752,31743],[358,214,28151],[571,361,28639],[597,700,31703],[38,408,27647],[672,738,28151],[515,133,27647],[445,886,31199],[877,453,31231],[170,844,32727],[886,275,31703],[380,186,28639],[48,17,31743],[66,515,31743],[892,571,31231],[170,566,31231],[200,328,31743],[644,553,28119],[83,171,27647],[647,762,31231],[361,659,32255],[317,429,27615],[328,32,32255],[881,488,32759],[30,303,27647],[255,857,32735],[420,877,28671],[170,68,27135],[663,361,32255],[624,496,31735],[882,186,28671],[864,852,31231],[49,519,28631],[327,583,27135],[662,333,32767],[311,725,31711],[429,80,32767],[105,433,28159],[220,672,31703],[642,307,27607],[287,404,31743],[564,529,28671],[17,272,32247],[106,64,28631],[846,792,31703],[32,659,27639],[80,792,27647],[429,842,31735],[646,271,32215],[857,358,31199],[761,395,27135],[307,130,31711],[667,746,27135],[276,726,32735],[522,49,27607],[522,351,28663],[364,496,32223],[349,80,31743],[564,867,31191],[646,761,28663],[317,837,31711],[48,571,32759],[662,614,28631],[529,524,32727],[519,524,32223],[672,781,28127],[668,230,31711],[599,361,31735],[881,105,31735],[496,556,31231],[788,546,31743],[634,398,28159],[324,845,27127],[317,417,32215],[271,272,27103],[644,761,31191],[178,114,31223],[320,10,28631],[68,433,27127],[14,726,27095],[420,659,31191],[211,384,31703],[241,15,31223],[691,395,28631],[417,75,32247],[220,170,27639],[762,642,32759],[243,49,31199],[599,259,28639],[703,303,31743],[191,271,32247],[857,519,28671],[453,752,31223],[382,603,11007],[183,770,27511],[616,655,26623],[459,625,13175],[511,780,26239],[54,682,13055],[94,587,12927],[144,853,26615],[855,225,13047],[635,435,11255],[360,765,16127],[132,654,30591],[578,45,10871],[267,227,31735],[436,777,14207],[40,641,32631],[577,435,31351],[836,437,16383],[669,728,26487],[159,530,30463],[623,115,15103],[128,694,29559],[669,172,30335],[23,890,8831],[728,436,13943],[103,34,31735],[305,835,28535],[865,803,28415],[636,686,30463],[145,776,25591],[437,372,26495],[449,616,30711],[166,382,12151],[655,355,8951],[228,687,29439],[498,357,15991],[226,183,14207],[655,830,25215],[791,360,32511],[355,680,28543],[126,248,14071],[830,242,11903],[227,865,26231],[698,803,13311],[34,354,32511],[268,828,12151],[756,669,8951],[493,582,16127],[480,733,12919],[79,520,31607],[21,578,10879],[549,329,15351],[570,874,28663],[348,131,25591],[305,568,16247],[727,640,31735],[727,459,16119],[708,244,16255],[616,741,9847],[41,339,10879],[344,477,31615],[568,759,29431],[246,750,8831],[869,655,15999],[698,604,15351],[884,690,11135],[655,835,10231],[343,830,12159],[734,289,10111],[119,608,32767],[773,59,8823],[381,549,14071],[208,813,8823],[348,225,31607],[436,427,12919],[493,521,16383],[708,34,10239],[694,710,9215],[264,853,30455],[812,450,14079],[450,688,29311],[81,884,32631],[385,859,30327],[769,759,30583],[427,516,29311],[251,506,8831],[103,687,29695],[104,640,10111],[697,53,9975],[450,823,11255],[608,853,31479],[227,812,30711],[832,574,11903],[481,756,28663],[480,743,10879],[215,79,31743],[853,365,10879],[800,103,8831],[216,225,9079],[52,827,11255],[54,560,27255],[223,217,30583],[289,744,15351],[21,549,11007],[450,52,16119],[122,394,28415],[800,305,30583],[777,146,10103],[27,686,30327],[134,570,11255],[694,640,13175],[381,655,29311],[180,499,25591],[308,740,28407],[638,803,9087],[593,727,8831],[167,526,30327],[768,291,11127],[835,227,9975],[454,87,12927],[225,716,27383],[289,153,14199],[426,197,26239],[412,791,27511],[382,102,30455],[94,405,26359],[264,151,15095],[385,840,29439],[486,616,11127],[227,776,12919],[313,197,12919],[525,119,28407],[31,506,25463],[578,604,14975],[580,305,29687],[645,219,30591],[718,699,10871],[145,288,13943],[368,510,9087],[382,516,12927],[708,648,28671],[680,830,14335],[308,289,29687],[687,697,14975],[720,34,25335],[348,16,28543],[791,122,26239],[621,728,12151],[94,804,14335],[180,159,15095],[707,560,9975],[580,840,31359],[698,716,31743],[204,180,30719],[648,774,14079],[789,31,14967],[179,568,10231],[582,183,25343],[31,53,9975],[814,743,15223],[759,300,12927],[81,608,13943],[146,806,15231],[826,560,25599],[693,812,29695],[21,648,14327],[392,284,26623],[385,718,15351],[828,430,28535],[300,343,15223],[879,98,27639],[727,521,14071],[53,649,15103],[616,203,14335],[727,880,26487],[274,197,30463],[219,812,10231],[396,73,27263],[694,268,11895],[740,568,11255],[727,426,15351],[774,412,11007],[699,344,32759],[608,169,14967],[486,45,12927],[690,457,14079],[481,636,14967],[299,655,14207],[603,710,28279],[441,596,32631],[483,45,13303],[480,570,12287],[766,866,15095],[512,225,30463],[645,686,10231],[229,718,11135],[74,261,11255],[151,183,8959],[437,773,14071],[699,203,11895],[54,134,12287],[179,841,9855],[166,558,13943],[743,396,28535],[756,766,32383],[122,766,12023],[759,841,32631],[345,183,32375],[516,225,32759],[61,423,31359],[747,288,25599],[780,151,9855],[159,779,15095],[645,669,14079],[368,37,8831],[884,861,25207],[268,94,15231],[760,773,27255],[506,510,32383],[830,45,16127],[686,52,31351],[704,217,16127],[510,209,10231],[727,131,26495],[421,743,16247],[203,308,30711],[625,432,30591],[266,530,27263],[528,810,10103],[204,791,31615],[504,511,32767],[574,146,26239],[304,122,29431],[374,219,31359],[128,486,12919],[680,9,29695],[251,640,15103],[774,710,15095],[177,98,26495],[181,449,32631],[698,670,29439],[59,521,27255],[477,548,16255],[835,716,15231],[396,244,12279],[481,248,27519],[506,128,28535],[441,689,14335],[807,473,31213],[793,681,32120],[627,378,32104],[847,400,32632],[847,378,31737],[473,96,32233],[281,25,32236],[807,193,32744],[205,793,32255],[318,378,32622],[378,400,32107],[821,205,32124],[473,399,31103],[138,581,31599],[847,447,32622],[821,400,31738],[657,118,32105],[565,473,31227],[318,193,31097],[681,719,31740],[118,400,32121],[260,473,32635],[657,681,32745],[318,581,31615],[581,847,31740],[96,518,31224],[447,657,31103],[719,400,31098],[318,138,32619],[28,205,31742],[821,260,32763],[793,28,32252],[193,447,32618],[318,281,31723],[96,193,32255],[847,205,31213],[748,719,31725],[399,473,32106],[518,400,31215],[719,378,31610],[847,378,31214],[118,399,32250],[96,281,31083],[400,473,32619],[96,518,31615],[399,206,32766],[447,205,31593],[473,205,31608],[565,657,31082],[399,473,32110],[447,28,32746],[565,748,31098],[118,28,31721],[118,627,31082],[719,205,31614],[118,581,32635],[260,399,31224],[793,821,32121],[206,793,31612],[138,28,31612],[260,138,32253],[378,260,31215],[807,719,32109],[627,205,31211],[581,793,32765],[627,318,32107],[260,627,32765],[627,565,32233],[378,581,32751],[657,260,31596],[193,627,32760],[118,793,32120],[96,399,31738],[399,400,32761],[657,378,32621],[473,28,31224],[847,378,31100],[748,793,31736],[581,657,32620],[793,657,32239],[681,260,31597],[378,518,31101],[447,378,32632],[847,681,32749],[318,748,32746],[748,281,32617],[118,627,32763],[25,807,31098],[581,281,32751],[473,378,31609],[748,847,31098],[96,193,31085],[260,118,31594],[205,118,31597],[748,378,32248],[719,400,31085],[25,378,32623],[748,138,32746],[821,28,32621],[193,378,32764],[28,581,31226],[565,206,31597],[784,278,65181],[751,292,65215],[485,1,65210],[795,870,65436],[676,607,65176],[97,618,65177],[326,199,65246],[109,485,65467],[120,418,65180],[71,825,65208],[1,36,65434],[418,67,65244],[341,110,65533],[532,487,65209],[292,195,65464],[43,545,65466],[26,798,65213],[198,783,65279],[286,714,65496],[63,848,65212],[628,315,65180],[628,116,65467],[534,505,65177],[434,198,65528],[478,257,65245],[563,35,65496],[36,63,65531],[245,247,65272],[751,196,65246],[189,839,65240],[101,478,65241],[732,393,65275],[147,531,65208],[90,338,65243],[1,834,65208],[545,199,65501],[870,112,65496],[326,278,65242],[839,472,65211],[26,8,65213],[462,350,65471],[611,784,65210],[92,591,65534],[462,198,65182],[563,253,65181],[702,598,65438],[628,199,65275],[850,532,65244],[97,538,65245],[315,434,65212],[767,366,65179],[696,563,65277],[569,69,65438],[112,569,65502],[754,598,65272],[629,592,65179],[834,247,65211],[270,505,65466],[397,238,65273],[325,176,65436],[834,245,65272],[196,831,65471],[234,825,65208],[245,247,65530],[819,163,65435],[247,742,65501],[487,706,65530],[825,834,65279],[563,502,65240],[469,257,65276],[418,1,65246],[629,222,65273],[598,89,65278],[531,784,65432],[270,110,65432],[1,611,65240],[505,112,65273],[878,595,65278],[116,783,65434],[199,425,65436],[411,350,65499],[825,772,65496],[89,97,65465],[714,607,65531],[505,117,65465],[277,270,65496],[767,36,65241],[8,508,65278],[292,595,65241],[446,42,65215],[110,198,65181],[798,825,65532],[709,142,15782],[572,250,11743],[33,501,32734],[33,250,32711],[514,250,28159],[142,537,11719],[33,250,28126],[709,854,11718],[33,201,11694],[142,590,11735],[715,709,16310],[142,709,28142],[501,537,11703],[514,854,32142],[455,854,28575],[709,514,32239],[709,854,11703],[444,715,16366],[142,715,28582],[501,715,15751],[715,575,15871],[514,572,16302],[854,455,12263],[455,854,12263],[590,201,16335],[709,444,28046],[501,455,28607],[321,572,15815],[543,142,11766],[543,709,12222],[854,543,32750],[250,572,32142],[100,537,11702],[715,543,12263],[250,455,32166],[543,455,11735],[62,537,16287],[100,455,28087],[201,543,28094],[715,572,15783],[455,142,11703],[135,632,28508],[282,72,28537],[851,332,11989],[495,626,16244],[60,11,32754],[233,475,32606],[632,280,16219],[891,322,28242],[808,717,11888],[815,717,12278],[632,829,32350],[736,322,15996],[442,822,32472],[678,684,15999],[140,470,28249],[232,664,32721],[47,475,32468],[584,661,11991],[233,661,28282],[626,790,32337],[11,369,32597],[332,883,15956],[322,158,12152],[72,584,15996],[280,175,32607],[584,369,28272],[140,18,12021],[660,375,32344],[279,161,16349],[60,660,15995],[451,280,15997],[475,811,12276],[158,369,28406],[451,470,12276],[717,232,16215],[233,258,32503],[736,824,28401],[157,442,28368],[757,322,32753],[47,332,28254],[736,829,11867],[235,29,28661],[630,633,12124],[282,409,16368],[175,314,28406],[684,630,28665],[470,786,11864],[0,376,28410],[29,442,16089],[684,448,16209],[165,443,95215],[731,165,96239],[252,656,97227],[316,554,97279],[252,165,97231],[165,554,98267],[252,165,97279],[656,601,96251],[656,601,98271],[252,316,97227],[731,252,95199],[554,731,95199],[443,165,95195],[731,554,96255],[165,554,95183],[165,656,95179],[316,443,98287],[252,656,97259],[165,731,98299],[554,443,96219],[165,252,98299],[554,656,95227],[316,165,97227],[656,443,96255],[316,656,95211],[554,443,95195],[731,601,97275],[335,252,96203],[316,335,96251],[316,656,98267],[373,212,56270],[562,149,55802],[838,602,64971],[873,149,56814],[858,838,65003],[129,873,64459],[401,129,53242],[858,149,55770],[586,173,95743],[461,356,45015],[753,210,59255],[388,753,63327],[356,461,65367],[221,550,97716],[622,539,97461],[331,463,97535],[463,643,97470],[484,492,98295],[889,440,97719],[724,387,97525],[463,492,97983],[463,550,98230],[643,387,97461],[440,539,97526],[56,724,97791],[889,745,97791],[492,440,98046],[463,724,97461],[56,440,97535],[99,55,12273],[674,137,16095],[650,99,27317],[99,875,14073],[650,722,13015],[77,55,14329],[125,507,88060],[12,51,30446],[735,12,30971],[876,218,31980],[12,735,31722],[85,108,63486]]
query=[[879,177],[526,167],[392,284],[664,815],[810,528],[858,602],[459,73],[85,108],[357,498],[624,758],[268,769],[838,602],[218,876],[261,74],[584,158],[12,735],[163,819],[401,602],[507,125],[623,115],[602,858],[626,790],[356,461],[661,824],[41,339],[526,167],[115,623],[591,92],[684,678],[108,85],[441,596],[444,543],[388,210],[448,684],[539,463],[577,635],[92,591],[85,108],[528,810],[286,714],[633,630],[650,55],[528,810],[587,800],[563,253],[722,875],[313,289],[676,714],[733,756],[279,161]]
print(sol.minimumCost(n, edges, query))